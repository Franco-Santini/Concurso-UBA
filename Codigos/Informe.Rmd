---
title: "Informe concurso AsterionHouse"
author: "Gazze Sim贸n, Moresi Manuel, Santini Franco"
date: "2025-08-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# La Casa de Asteri贸n: estimaci贸n de demanda y optimizaci贸n de precios de art铆culos de venta minorista

```{r}
library(dplyr)
library(knitr)
library(kableExtra)
library(readr)
library(sparklyr)
library(ggplot2)
library(data.table)
library(arrow)
library(plotly)
library(lubridate)
library(usmap)

eci_stores <- read_csv("Datos/eci_stores.csv")

eci_product_groups <- read_csv("Datos/eci_product_groups.csv")

eci_product_master <- read_csv("Datos/eci_product_master.csv")

eci_stores_clusters <- read_csv("Datos/eci_stores_clusters.csv")
```

```{r}
#Datos

#df <- fread("Datos/eci_transactions.csv")  

#write_parquet(df, "eci_transactions.parquet")

#Configuraciones de spark
config <- spark_config()

# Establecemos la coneccion con spark
sc <- spark_connect(master = "local", config = config)

#ds <- open_dataset("eci_transactions.parquet")

#eci_transactions <- spark_read_parquet(sc, name = "eci_transacciones", path = "../eci_transactions.parquet")

#Para la base completa

# Copiar tabla de tiendas y productos a Spark

#eci_product_master <- rename(eci_product_master, SKU = sku, SUBGROUP = subgroup)
#eci_stores_tbl   <- copy_to(sc, eci_stores,        name = "eci_stores",        overwrite = TRUE)
#eci_products_tbl <- copy_to(sc, eci_product_master, name = "eci_product_master", overwrite = TRUE)

#Agrego los costos y precios base

#datos_tbl <- eci_transactions %>%
#  left_join(eci_products_tbl, by = c("SKU", "SUBGROUP"))

#Agrupo por el d铆a, subproducto y tienda.

#print(colnames(datos_tbl))#Voy viendo que todas las variables esten

#datos_tbl <- datos_tbl %>%
#  mutate(QUANTITY = round(TOTAL_SALES / PRICE)) %>%
#  group_by(STORE_SUBGROUP_DATE_ID, category, group) %>%
#  summarise(
#    TOTAL_SALES_        = sum(TOTAL_SALES),
#    QUANTITY_           = sum(QUANTITY),
#    PRICE_              = sum(PRICE),
#    BASE_PRICE_         = sum(base_price),
#    INITIAL_TICKET_PRICE_ = sum(initial_ticket_price),
#    COSTOS_             = sum(costos)
#  ) %>%
#  ungroup() %>%
#  mutate(STORE_SUBGROUP_DATE_ID_2 = STORE_SUBGROUP_DATE_ID) %>%
#  tidyr::separate(STORE_SUBGROUP_DATE_ID_2, into = c("STORE_ID","SUBGROUP","DATE_ID"), sep = "_") #%>%
#  left_join(eci_stores_tbl, by = "STORE_ID")

#datos_tbl <- datos_tbl %>%
#  mutate(
#    DATE_ID = to_date(DATE_ID),  # convertir a fecha
#    DAY_OF_WEEK = date_format(DATE_ID, "E")  # "Mon", "Tue", ...
    # si quer茅s n煤mero: DAY_OF_WEEK = date_format(DATE_ID, "u") # 1=lunes ... 7=domingo
  )

  # Paso 1: convertir DATE_ID a Date
  

#print(colnames(datos_tbl))#Voy viendo que todas las variables esten

#Observo la cantidad de filas

#datos_tbl %>% tally()

#Obtengo el archivo .parquet de la base que usaremos para el objetivo 1

#spark_write_parquet(
#  datos_tbl,
#  path = "Datos/datos_final.parquet",
#  mode = "overwrite"  # o "append" si quer茅s agregar
#)

transactions_df <- read.csv("Datos/eci_transactions.csv", nrows = 6)

#Leo el archivo final y empiezo a hacer consultas

ds_final <- open_dataset("./Datos/datos_final_1.parquet")

print(colnames(ds_final))#Voy viendo que todas las variables esten

```

## Introducci贸n

La empresa *La Casa de Asteri贸n* es una cadena de negocios minoristas de art铆culos para el hogar, la cual cuenta con 15 tiendas en distintas regiones de Estados Unidos. Recientemente dicha empresa ha detectado una reducci贸n en las ganancias y buscan evaluar y mejorar su estrategia de precios para aumentar el rendimiento.

Teniendo en cuenta que la fijaci贸n de precios es un factor clave para el rendimiento de cualquier negocio. Un precio demasiado alto puede reducir el volumen de ventas, mientras que uno demasiado bajo puede disminuir el margen de ganancia, incluso si la demanda aumenta. Encontrar el punto de equilibrio adecuado requiere no solo un an谩lisis detallado de las ventas y de la elasticidad de la demanda, sino tambi茅n la consideraci贸n de factores externos como la competencia, la estacionalidad y los cambios en las preferencias de los consumidores.

Se busca comprender a fondo la relaci贸n entre sus precios, la demanda y otros factores que puedan influir en su rendimiento, con el objetivo de implementar una estrategia de precios m谩s eficiente y orientada a resultados.

Se trabajar谩 con informaci贸n proveniente de las transacciones realizadas en 9 cadenas de negocios minoristas, entre las que se encuentra nuestro cliente *La casa de Asterion*, en un periodo de 3 a帽os, donde se podr谩 obtener informaci贸n de cada uno de los negocios y diferentes caracter铆sticas relacionadas al producto que se vende.

**Aclaraci贸n**: cuando se habla de transacci贸n no refiere al evento completo de la compra, sino a la cantidad de productos iguales dentro de una compra.

## Objetivos

A lo largo de este trabajo tendremos en cuenta 2 objetivos principales:

1)  *Predecir la demanda diaria de la semana siguiente a la finalizaci贸n de los datos disponibles*.

En base a la informaci贸n prevista de las transacciones, se busca generar un modelo predictivo con el cual se pueda estimar de manera adecuada la demanda en pesos (\$) para cada uno de los d铆as en la semana posterior al fin de los datos (desde el 1/1/2024 al 7/1/2024) de los distintos subproductos, en cada una de las tiendas minoristas.

2)  *Proponer soluciones para maximizar la ganancia*.

Como ya se mencion贸 anteriormente, la cadena *Casa de Asteri贸n* present贸 una disminuci贸n de las ganancias en el 煤ltimo tiempo. Por lo que se busca identificar, para cada subgrupo de productos, el precio 贸ptimo que maximice la ganancia, equilibrando el ingreso por unidad vendida con el volumen total de ventas y de esta manera poder revertir la situaci贸n.

## Metodolog铆a

### Datos

Fueron proporcionadas 6 bases de datos con distinta informaci贸n relevante para la realizaci贸n de este trabajo:

-   `eci_transaction`

Es la base de datos principal en este trabajo, en ella se encuentra informaci贸n referida a las transacciones realizadas desde el 1 de enero de 2021 hasta el 31 de diciembre de 2023, en las 157 tiendas minoristas presentes en el estudio (pertenecientes a las 9 cadenas ya mencionadas). Las variables aqu铆 presentes son:

<details>

<summary> Variables</summary>

-   `TRANSACTION_ID` : id de la transacci贸n

-   `DATE` : fecha de la transacci贸n

-   `STORE_ID` : id de la tienda

-   `SKU`: n煤mero de referencia CCCGGSSXXX donde C es la categor铆a, G el grupo, S subgrupo y X es el n煤mero secuencial del producto

-   `QUANTITY`: cantidad de productos que se vendieron en esa transacci贸n.

-   `PRICE`: precio del producto.

-   `TOTAL_SALES` (`PRICE` x `QUANTITY`): dinero que recibe el local en una transacci贸n.

-   `SUBGROUP`: subproducto.

-   `STORE_SUBGROUP_DATE_ID`: es el id del subproducto en cierta tienda y en cierta fecha.

</details>

<br>

-   `eci_stores`

Contiene informaci贸n particular de cada una de las distintas tiendas minoristas,presentando informaci贸n relacionada a la ubicaci贸n y al tipo de tienda.En esta base de datos encontramos:

<details>

<summary> Variables</summary>

-   `STORE_ID` : id de la tienda.

-   `BRAND` : cadena a la que pertenece la tienda.

-   `STORE_NAME` (generalmente formado por BRAND - CITY): nombre de la tienda.

-   `ADDRESS1` y `ADDRESS2`: informaci贸n sobre la direcci贸n de la tienda.

-   `CITY`: ciudad de la tienda.

-   `STATE` : estado de la tienda.

-   `ZIP` : c贸digo postal de la tienda.

-   `OPENDATE` y `CLOSEDATE` : fecha de inicio y de cierre de la tienda.

-   `STORE_TYPE`: tipo de tienda.

-   `REGION`: regi贸n de la tienda.

</details>

<br>

-   `eci_stores_cluster`

Este archivo contiene informaci贸n de las tiendas minoristas, repitiendo las variables `STORE_ID`, `BRAND` y `STORE_NAME`, y agrega una variable que agrupa las tiendas por zona o regi贸n:

<details>

<summary> Variables</summary>

-   `STORE_ID` : id de la tienda.

-   `BRAND` : cadena a la que pertenece la tienda.

-   `STORE_NAME` (generalmente formado por BRAND - CITY): nombre de la tienda.

-   `CLUSTER`: zona o regi贸n de la tienda.

</details>

<br>

-   `eci_product_master`

Contiene informaci贸n m谩s espec铆fica de los productos como el nombre, el precio inicial, el precio sugerido por el fabricante, los costos del mismo, entre otras:

<details>

<summary> Variables</summary>

-   `SKU`: n煤mero de referencia CCCGGSSXXX donde C es la categor铆a, G el grupo, S subgrupo y X es el n煤mero secuencial del producto

-   `PRODUCT_NAME`: nombre del producto.

-   `CATEGORY`: categor铆a del producto.

-   `GROUP`: grupo del producto.

-   `SUBGROUP`: subproducto.

-   `BRAND`: cadena a la que pertenece la tienda.

-   `base_price`: precio al que el negocio puso en venta al producto en primera instancia.

-   `initial_ticket_price`: precio del producto sugerido por el fabricante.

-   `costos`: costo del producto.

</details>

<br>

-   `eci_product_groups`

Identifica productos que han estado en precio promocional por alg煤n motivo, contiene las siguientes variables:

<details>

<summary> Variables</summary>

-   `SKU`: n煤mero de referencia CCCGGSSXXX donde C es la categor铆a, G el grupo, S subgrupo y X es el n煤mero secuencial del producto

-   `PRODUCT_NAME`: nombre del producto.

-   `price_group_id`: id de la promoci贸n.

-   `price_group_name`: nombre completo de la promoci贸n.

-   `group_type`: tipo de promoci贸n.

</details>

<br>

-   `eci_customer_data`

Contiene informaci贸n de 801923 clientes, identificando datos personales de los mismos e identificando a los que son socios de dichas cadenas:

<details>

<summary> Variables</summary>

-   `client_id`: id del cliente.

-   `phone_number`: n煤mero del cliente.

-   `email_address`: direcci贸n de email del cliente.

-   `city`: ciudad de residencia del cliente.

-   `state`: estado de residencia del cliente.

-   `zip_code`: codigo postal del lugar de residencia del cliente.

-   `education_level`: nivel de educaci贸n del cliente.

-   `occupation`: ocupaci贸n del cliente.

-   `loyalty_member`: identifica si el cliente es socio o no de la cadena.

-   `loyalty_number`: n煤mero de socio del cliente en caso de serlo.

-   `loyalty_points`: puntos de membres铆a del cliente socio.

</details>

### Manejo de los datos

Antes de iniciar el an谩lisis, fue necesario realizar una inspecci贸n exhaustiva de los datos. Este proceso permiti贸 identificar aspectos relevantes vinculados al preprocesamiento, tales como la detecci贸n de valores at铆picos, la presencia de datos faltantes y otras cuestiones que requer铆an tratamiento previo. Dichas cuestiones se enuncian a continuaci贸n:

-   *Base de clientes (`eci_customer_data`)*

Al analizar las variables disponibles en esta base, qued贸 evidenciado que no hay una variable que conecte la informaci贸n aqu铆 disponible con el resto de las bases. Es decir, se cuenta con la informaci贸n de los clientes, pero no es posible identificar en que tienda compra cada uno, o que transacci贸n realiza cada uno. Por este motivo no se utilizar谩 esta informaci贸n, al menos en este primer an谩lisis.

-   *Outliers*

Observando las variables cuantitativas de las bases de datos que se usar谩n inicialmente **no** se detectaron valores at铆picos.

(Insertamos tabla con quartiles, minimo, media y maximo?)

-   *Valores faltantes*

Se realiz贸 una inspecci贸n por cada una de las variables de inter茅s y en la base de datos `eci_transaction` se encontraron valores faltantes en la variable `QUANTITY`, la cual como mencionamos anteriormente puede calcularse como `TOTAL_SALES`/`PRICE`, de esta manera se pudo reconstruir el dato e imputar todos los valores faltantes de dicha variable.

En la base de datos `eci_stores`, hay datos faltantes en las variables `ADDRESS2`, `CLOSEDATE` y `STORE_TYPE`. Para las variables `ADDRESS2` y `CLOSEDATE` puede que esto no sea un error en s铆, sino que no esten los datos debido a que la tienda no tiene una segunda direcci贸n o porque todav铆a no cerr贸 respectivamente. Para la variable `STORE_TYPE` encontramos 2 datos faltantes, en los locales QuickBuy - Columbia y MarketExpress Lakewood Uptown, los cuales fueron reemplazados por el valor *Unknown*, ya que no es posible saber de que tipo de tienda se trata.

-   *Datos del subproducto "Basketball"*

Al revisar la base de transacciones (`eci_transaction`) se identific贸 que no existen registros asociados al subproducto "Basketball", a pesar de que este se encuentra incluido en la base de productos (`eci_product_master`) y forma parte de los subproductos a predecir en el primer objetivo. Una posible explicaci贸n es que los SKU correspondientes a los subproductos de las categor铆as "Basketball" y "Baseball" presentan coincidencias en su codificaci贸n (por ejemplo, SPOTEBA001), lo que podr铆a haber generado un error en el proceso de carga de datos y derivado en la ausencia de registros para "Basketball".

Una alternativa para solucionar este problema fue realizar el supuesto de que la demanda de ambos subproductos era similar, y en base a esto realizar las correspondientes predicciones. Como no se cuenta con la informaci贸n de la demanda, ya que no podemos identificarlos entre las transacciones, podemos evidenciar las similitudes en las variables `base_price`, `initial_ticket_price` y `costos`:

```{r}
eci_product_master |> 
  filter(sku %in% c("SPOTEBA001", "SPOTEBA002", "SPOTEBA003", 
                    "SPOTEBA004", "SPOTEBA005", "SPOTEBA006", 
                    "SPOTEBA007", "SPOTEBA008")) |> 
  group_by(subgroup) |> 
  summarise(
    base_price_avg = mean(base_price, na.rm = TRUE),
    initial_ticket_price_avg = mean(initial_ticket_price, na.rm = TRUE),
    costos_avg = mean(costos, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  mutate(across(where(is.numeric), ~ round(.x, 2))) |> 
  kable(format = "html", caption = "Promedios de precios y costos por Subgrupo (Baseball vs Basketball)") |> 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), 
                full_width = FALSE, position = "center")

```

Se observan similitudes tanto en los precios iniciales promedio, como en los costos promedios para los productos de Basketball y Baseball.

## Desarrollo

### Objetivo 1 - Estimaci贸n de demanda

bla bla bla- podemos hablar de que modelos vamos a usar en grandes rasgos, onda usaremos modelos de machine learning y series de tiempo para predecir la demanda.

#### Preprocesamiento de los datos - Objetivo 1

Para la preparaci贸n de los datos, se realizaron diversos procesos de depuraci贸n y combinaci贸n de las bases disponibles, con el fin de obtener un conjunto 煤nico que permitiera entrenar el modelo de predicci贸n de la demanda.

En primer lugar, a partir de la base `eci_stores` se identificaron y excluyeron aquellas tiendas que hab铆an cerrado antes de la semana del 1 al 7 de enero de 2024, ya que no tendr铆a sentido estimar demanda para locales que ya no se encontraban operativos.

Posteriormente se combinaron las bases `eci_stores` y `eci_product_master` con la base `eci_transactions`. De esta forma, cada transacci贸n no solo contiene informaci贸n sobre la venta realizada, sino tambi茅n el nombre y la categor铆a del producto, la tienda donde se comercializ贸 y su regi贸n, la franquicia a la que pertenece, entre otras caracter铆sticas.

Sobre esta base consolidada, se generaron 3 nuevas variables temporales a partir de la columna `DATE`, extrayendo el d铆a, mes y a帽o de cada transacci贸n.

Finalmente, las transacciones se agruparon por d铆a, por subproducto y por tienda (`STORE_SUBGROUP_DATE_ID`), con el prop贸sito de entrenar los datos de esa manera y asi poder cumplir el objetivo de predecir la demanda desde el 1/1/2024 al 7/1/2024 de los distintos subproductos, en cada una de las tiendas minoristas. Tambi茅n, como dato adicional, esto hace que se reduzca el costo computacional que conlleva entrenar los datos, debido a la reduccion de filas en la base que este agrupamiento implica, pasando de trabajar con 19.004.759 de datos a una base final con 5.137.958 de datos.

En s铆ntesis, el proceso de preparaci贸n de datos permiti贸 pasar de m煤ltiples bases dispersas a un 煤nico conjunto de datos estructurado, listo para ser utilizado en el entrenamiento de los modelos predictivos.

#### An谩lisis descriptivo - Objetivo 1

Al querer estimar la demanda (`TOTAL_SALES`) de manera adecuada, se plantea el an谩lisis descriptivo buscando evidenciar que variables entre las que se encuentran disponibles en nuestras bases pueden influir en el comportamiento de la variable respuesta mencionada.

Se cuenta con informaci贸n de articulos pertenecientes a 73 subproductos distintos, e inicialmente se quiere evidenciar si hay diferencias en la demanda para los distintos subproductos.

```{r}
# Conteo por subgrupo
conteo_subgrupo <- ds_final %>%
  group_by(SUBGROUP) %>%
  summarise(total_ventas = sum(TOTAL_SALES_, na.rm = TRUE),
            cantidad = sum(QUANTITY_, na.rm = TRUE)) %>%
  collect()


#Gr谩fico de barras

plot_ly(
  data = conteo_subgrupo,
  x = ~total_ventas,
  y = ~reorder(SUBGROUP, total_ventas),
  type = "bar",
  orientation = "h",
  marker = list(color = "steelblue")
) %>%
  layout(
    title = "Demanda total (en $) por Subgrupo",
    xaxis = list(title = "Demanda"),
    yaxis = list(title = "Subgrupo")
  )

#Porcentaje que acumulan los 9 primeros

# Vector con los 9 subgrupos
top_subgrupos <- c("Headphones", "Speakers", "Wearables", "Desktops", 
                   "Smartphones", "Home Audio", "Tablets", "Accesories", "Laptops")

# Calcular porcentaje
porcentaje_top <- conteo_subgrupo %>% 
  mutate(es_top = SUBGROUP %in% top_subgrupos) %>%
  group_by(es_top) %>%
  summarise(total_ventas_2 = sum(total_ventas, na.rm = TRUE)) %>%
  mutate(pct = 100 * total_ventas_2 / sum(total_ventas_2))

porcentaje_top

```

Claramente se observa que hay 9 subproductos que generaron mucha mayor demanda que el resto, estos productos son Headphones, Speakers, Wearables, Desktops, Smartphones, Home Audio, Tablets, Accesories y Laptops; acumulando un 42% de la demanda total.

Estos art铆culos tienen caracter铆sticas muy similares, todos ellos corresponden a productos electr贸nicos vinculados principalmente a la inform谩tica, telecomunicaciones y entretenimiento audiovisual.

Otra variable que puede influir en la demanda de cada subproducto es la fecha en la que se produjo la transacci贸n, para esto se mostrar谩 la evoluci贸n de la demanda a trav茅s de los meses en los 3 a帽os que abarca este estudio, y complementariamente mostraremos la demanda por d铆a de la semana.

```{r}
# 1. Calcular ventas totales por subgrupo (para ordenar)
top_subgrupos <- ds_final %>%
  group_by(SUBGROUP) %>%
  summarise(total = sum(TOTAL_SALES_, na.rm = TRUE)) %>%
  arrange(desc(total)) %>%
  head(10) %>%
  collect() %>%
  pull(SUBGROUP)

# 2. Filtrar dataset solo con esos subgrupos
ventas_mensuales <- ds_final %>%
  mutate(month = floor_date(as.Date(DATE_ID), "month")) %>%
  filter(SUBGROUP %in% top_subgrupos) %>%
  group_by(month, SUBGROUP) %>%
  summarise(total_sales = sum(TOTAL_SALES_, na.rm = TRUE), .groups = "drop") %>%
  collect() %>%
  arrange(SUBGROUP, month)   #  aseguramos orden temporal dentro de cada subgrupo


# 3. Gr谩fico interactivo con Plotly
p <- ventas_mensuales %>%
  plot_ly(
    x = ~month,
    y = ~total_sales,
    color = ~SUBGROUP,
    type = "scatter",
    mode = "lines"
  ) %>%
  layout(
    title = "Evoluci贸n mensual de ventas - Top 10 subgrupos",
    xaxis = list(title = "Mes"),
    yaxis = list(title = "Ventas Totales")
  )
p
```

3 encuentran picos de ventas entre abril y mayo de 2022

otros 3 encuentran picos en julio de 2022

Se procede a analizar la demanda en las distintas regiones geogr谩ficas en las cuales pertenecen estas tiendas:

```{r}
ventas_estado <- ds_final %>%
group_by(STATE) %>%
summarise(total_sales = sum(TOTAL_SALES_),
cant_stores = n_distinct(STORE_ID),
.groups = "drop"
)
 
# unir las ventas con el mapa de estados
plot_data <- ventas_estado %>%
mutate(state = STATE,
ventas_tiendas = total_sales/cant_stores) %>%
collect()


plot_usmap(data = plot_data, values = "total_sales", regions = "states") +
scale_fill_continuous(
low = "white", high = "steelblue", name = "Demanda total por estado"
) +
theme(legend.position = "right")
```

Se observa que los estados con mayor demanda monetaria se encuentran en la zona de la costa este de Estados Unidos,concentrandose en los estados de Nueva York, Florida, Georgia y Carolina del Sur. Pero este analisis inicial no necesariamente nos da una evidencia con respecto a que estos estados influyen en las ventas de las tiendas, debido a que hay distinta cantidad de tiendas en cada uno de estos. A continuaci贸n para tratar este problema, se vuelve a realizar este gr谩fico pero calculando la demanda promedio de cada uno de estos estados:


```{r}
plot_usmap(data = plot_data, values = "ventas_tiendas", regions = "states") +
scale_fill_continuous(
low = "white", high = "steelblue", name = "Demanda promedio por estado"
) +
theme(legend.position = "right")
```
Al realizar esta modificaci贸n el panorama ya no es el mismo, se puede observar que los estados que mayor demanda promedio tienen estan en el suroeste y son los estados de Nuevo M茅xico y Arizona (contando con 2 y 5 tiendas respectivamente). Otra particularidad que no se evidenciaba en el otro gr谩fico es que los estados con menor demanda promedio se encuentran todos en la regi贸n noroeste del pa铆s, lo que nos lleva a pensar que puede que esa sea una zona con menor consumo.



```{r}
# Conteo por subgrupo
conteo_store_type <- ds_final %>%
  mutate(STORE_TYPE = if_else(is.na(STORE_TYPE), "Unknown", STORE_TYPE)) %>%
  group_by(STORE_TYPE) %>%
  summarise(total_ventas = sum(TOTAL_SALES_, na.rm = TRUE)) %>%
  collect()

conteo_tiendas = eci_stores %>%
  mutate(STORE_TYPE = if_else(is.na(STORE_TYPE), "Unknown", STORE_TYPE)) %>%
  group_by(STORE_TYPE) %>%
  summarise(cantidad_tiendas = n())

conteo_store_type = conteo_store_type %>%
  left_join(conteo_tiendas, by = "STORE_TYPE")


#Gr谩fico de barras

p1 <- plot_ly(
  conteo_store_type,
  x = ~total_ventas,
  y = ~reorder(STORE_TYPE, total_ventas),
  type = "bar",
  orientation = "h",
  name = "Demanda total ($)",
  marker = list(color = "steelblue")
) %>%
  layout(
    xaxis = list(title = "Demanda total ($)"),
    yaxis = list(title = "Tipo de Tienda")
  )

p2 <- plot_ly(
  conteo_store_type,
  x = ~cantidad_tiendas,
  y = ~reorder(STORE_TYPE, total_ventas),
  type = "bar",
  orientation = "h",
  name = "Cantidad Tiendas",
  marker = list(color = "maroon")
) %>%
  layout(
    xaxis = list(title = "Cantidad de Tiendas"),
    yaxis = list(title = "Tipo de Tienda")
  )

subplot(p1, p2, nrows = 2, shareY = TRUE, titleY = TRUE) %>%
  layout(title = "Demanda total ($) y Cantidad de Tiendas por Tipo")
```

Se puede apreciar con claridad que las tiendas de tipo Street y Mall son las que mayores demanda presentan, con la particularidad que existen las mismas cantidades de tiendas de estos tipos (44 cada uno), y sin embargo las de tipo Street tuvieron una demanda de $48.194.937 mayor. 

Al analizar los gr谩ficos, se observa de manera l贸gica que una mayor cantidad de tiendas se asocia con un incremento en la demanda.


```{r}
# Conteo por brand
conteo_brand <- ds_final %>%
  group_by(BRAND) %>%
  summarise(total_ventas = sum(TOTAL_SALES_, na.rm = TRUE)) %>%
  collect()

conteo_franquicia = eci_stores %>%
  group_by(BRAND) %>%
  summarise(cantidad_tiendas = n())

conteo_brand = conteo_brand %>%
  left_join(conteo_franquicia, by = "BRAND")


#Gr谩fico de barras

p1 <- plot_ly(
  conteo_brand,
  x = ~total_ventas,
  y = ~reorder(BRAND, total_ventas),
  type = "bar",
  orientation = "h",
  name = "Demanda total ($)",
  marker = list(color = "steelblue")
) %>%
  layout(
    xaxis = list(title = "Demanda total ($)"),
    yaxis = list(title = "Marca")
  )

p2 <- plot_ly(
  conteo_brand,
  x = ~cantidad_tiendas,
  y = ~reorder(BRAND, total_ventas),
  type = "bar",
  orientation = "h",
  name = "Cantidad Tiendas por Marca",
  marker = list(color = "maroon")
) %>%
  layout(
    xaxis = list(title = "Cantidad de Tiendas"),
    yaxis = list(title = "Marca")
  )

subplot(p1, p2, nrows = 2, shareY = TRUE, titleY = TRUE) %>%
  layout(title = "Demanda total ($) y Cantidad de Tiendas por Marca")
```

Se evidencia que la marca Essentials Plus es la que mayor demanda presenta, siendo tambi茅n la marca con mayor cantidad de tiendas.

#### T茅cnicas estad铆sticas - Objetivo 1

#### Resultados - Objetivo 1

### Objetivo 2 - Optimizaci贸n de precios

bla bla bla

#### Preprocesamiento de los datos - Objetivo 2

calculo de la ganancia y bla bla bla

#### An谩lisis descriptivo - Objetivo 2

#### T茅cnicas estad铆sticas - Objetivo 2

#### Resultados - Objetivo 2

## Resultados generales y conclusiones




